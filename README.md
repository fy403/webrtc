# é¢å‘ä½å»¶æ—¶ï¼Œç‚¹å¯¹ç‚¹ã€è¿œç¨‹éŸ³è§†é¢‘ä¸ä¿¡å·æ§åˆ¶çš„4Gé¥æ§è½¦ç³»ç»Ÿ

![License](https://img.shields.io/badge/license-MIT-yellow) ![Language](https://img.shields.io/badge/language-C++-blue) ![Language](https://img.shields.io/badge/language-HTML-blue)

![WebRTC](https://img.shields.io/badge/WebRTC-4682B4)![P2P](https://img.shields.io/badge/P2P-FF6347)![Linux](https://img.shields.io/badge/Linux-5F9EA0)![C++](https://img.shields.io/badge/C++-6495ED)![HTML](https://img.shields.io/badge/HTML-6495ED)![FFmpeg](https://img.shields.io/badge/FFmpeg-8A2BE2)![H264](https://img.shields.io/badge/H264-8A2BE2)![Opus](https://img.shields.io/badge/Opus-8A2BE2)![å¤šçº¿ç¨‹](https://img.shields.io/badge/å¤šçº¿ç¨‹-8A2BE2)![RNDIS](https://img.shields.io/badge/RNDIS-8A2BE2)![USBæ‘„åƒå¤´](https://img.shields.io/badge/USBæ‘„åƒå¤´-6A5ACD)![USBéº¦å…‹é£](https://img.shields.io/badge/USBéº¦å…‹é£-7B68EE)![4Gç½‘ç»œ](https://img.shields.io/badge/4Gç½‘ç»œ-9370DB)![WIFI](https://img.shields.io/badge/WIFI-9932CC)![å¼€å‘æ¿](https://img.shields.io/badge/å¼€å‘æ¿-8B008B)![ç”µæœºé©±åŠ¨å™¨](https://img.shields.io/badge/ç”µæœºé©±åŠ¨å™¨-BA55D3)![RCé¥æ§è½¦](https://img.shields.io/badge/RCé¥æ§è½¦-FF6347)

### âŒ›æ¬¢è¿starâœ¨ä»»ä½•é—®é¢˜å‘issueğŸ‘¨â€ğŸ«æ¬¢è¿ä¸€èµ·è´¡çŒ®ä»£ç ğŸŠ[æºç åœ°å€](https://github.com/fy403/webrtc)
[TOC]

## é¡¹ç›®åˆè¡·

 **æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸ªäººå­¦ä¹ æ€§è´¨çš„å¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨ç³»ç»Ÿå­¦ä¹ å’Œå®è·µéŸ³è§†é¢‘å¼€å‘ç›¸å…³çŸ¥è¯†ï¼Œå¹¶ç»“åˆå®é™…ç¼–ç¨‹è¯­è¨€æé«˜åŠ¨æ‰‹èƒ½åŠ›ã€‚åœ¨æ•´ä¸ªç³»ç»Ÿè®¾è®¡ä¸å®ç°è¿‡ç¨‹ä¸­ï¼Œæ³¨é‡ä»£ç çš„å¯æ‰©å±•æ€§ï¼Œæ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½å°½é‡ä»¥ç‹¬ç«‹å‡½æ•°åº“çš„å½¢å¼å‘ˆç°ï¼Œä¾¿äºåç»­å¤ç”¨ä¸æ‹“å±•ã€‚åŒæ—¶ï¼Œåœ¨ä»£ç å®ç°ä¸Šè¿½æ±‚ç®€æ´æ¸…æ™°ï¼Œå‰”é™¤å†—ä½™é€»è¾‘ï¼Œä¸“æ³¨äºä¿ç•™æœ€æ ¸å¿ƒã€æœ€æœ¬è´¨çš„å®ç°å†…å®¹ï¼Œå¸®åŠ©ç†è§£åº•å±‚åŸç†ã€‚**

## é¡¹ç›®ä»‹ç»

**é¡¹ç›®ä¸»è¦é¢å‘RCé¥æ§è½¦æ”¹é€ ï¼Œå¸Œæœ›åœ¨é¥æ§è½¦åŸºç¡€ä¸Šå¼€å‘ä½å»¶æ—¶ã€ç‚¹å¯¹ç‚¹ã€å¯è¿œç¨‹æ§åˆ¶ã€å¯æ•è·ç”»é¢å’Œå£°éŸ³çš„é¥æ§è½¦ã€‚é‡‡ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆæ˜¯é€šè¿‡RTPå°†é‡‡é›†çš„éŸ³è§†é¢‘æˆ–è€…æ˜¯ç›‘æ§æ•°æ®ä¼ è¾“åˆ°æ§åˆ¶ç«¯ï¼›å°†æ§åˆ¶ä¿¡å·ä¹Ÿé€šè¿‡RTPä¼ è¾“åˆ°è¢«æ§é¥æ§è½¦ï¼Œé¥æ§è½¦é€šè¿‡è§£æåè®®ï¼Œè½¬æ¢ä¸ºå‘½ä»¤æ§åˆ¶é¥æ§è½¦ã€‚æŠ€æœ¯æ–¹æ¡ˆå°½å¯èƒ½å‡å°‘æœåŠ¡å™¨çš„å‚ä¸ï¼Œæµé‡ç›´æ¥ç‚¹å¯¹ç‚¹ä¼ è¾“ã€‚**

## æ¼”ç¤ºæ•ˆæœ

<iframe src="//player.bilibili.com/player.html?isOutside=true&aid=115489808323280&bvid=BV1VA1kBnEAx&cid=33681311377&page=1&high_quality=1&danmaku=0" allowfullscreen="allowfullscreen" width="100%" height="500" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"></iframe>

## å¿«é€Ÿè¿è¡Œ

### 1.ä¾èµ–å®‰è£…ï¼ˆubuntuä¸ºä¾‹ï¼‰

#### 1.1 ä¿¡ä»¤æœåŠ¡å™¨æ­å»º

ä¿¡ä»¤æœåŠ¡å™¨ä¸»è¦æ˜¯ååŠ©WebRTCåŒæ–¹äº¤æ¢SDPï¼ˆéŸ³è§†é¢‘å‚æ•°ä¿¡æ¯ï¼‰ä»¥åŠICEï¼ˆåŒæ–¹ç½‘ç»œåœ°å€ä¿¡æ¯ï¼‰ã€‚æ‰€ä»¥è¦æƒ³æ”¯æŒ4Gè¿œç¨‹ï¼Œéœ€è¦è´­ä¹°ä¸€ä¸ªä¾¿å®œçš„å»ºç«™æœåŠ¡å™¨å°±è¡Œï¼Œæˆæœ¬70/å¹´(2H2G)ã€‚æœåŠ¡å™¨éœ€è¦æœ‰å…¬ç½‘ipï¼ŒæœåŠ¡å™¨ä¸éœ€è¦å¾ˆå¤§çš„å¸¦å®½ï¼ˆä¸è´Ÿè´£ä¼ è¾“æµåª’ä½“æ•°æ®ï¼‰ã€‚
##### ä¸‹è½½é¡¹ç›®
```shel
git clone https://github.com/fy403/webrtc
```
##### ä¾èµ–å®‰è£…
æ–¹æ³•1ï¼šnodejs
```shell
cd webrtc/signaling_server/nodejs
# å®‰è£…nodejs, npm
sudo apt install nodejs npm
# å®‰è£…ä¾èµ–
npm install 
```

æ–¹æ³•2ï¼špython3
```shell
cd webrtc/signaling_server/python3
# å®‰è£…python3, pip3
sudo apt install python3 python3-pip
pip3 install -r requirements.txt
```

##### å¯åŠ¨ä¿¡ä»¤æœåŠ¡å™¨
```shel
chmod +x ./install && ./install
```

> é»˜è®¤ç«¯å£æ˜¯8000, è®°å¾—æœåŠ¡å™¨å…è®¸é˜²ç«å¢™TCP:8000ç«¯å£æµé‡é€šè¿‡ã€‚
> å¦‚æœfy403.cn:8000è¿˜èƒ½ç”¨ï¼Œé‚£ä¹ˆå°±ä¸ç”¨æ­å»ºä¿¡ä»¤æœåŠ¡å™¨äº†ã€‚ç›´æ¥ç”¨æˆ‘çš„å°±è¡Œï¼Œä½†æ˜¯è®°ä½ä¸€å®šè¦é…ç½®å”¯ä¸€çš„`CLIENT_ID="usbcam" # å®¢æˆ·ç«¯ID`ã€‚ã€å¦‚æœå†²çªï¼Œè¯·è‡ªè¡Œä¿®æ”¹ã€‘

#### 1.2 STUN/TURNæœåŠ¡å™¨å‡†å¤‡

STUN/TRUNæœåŠ¡å™¨æ˜¯ç”¨æ¥è·å–WebRTCåŒæ–¹çš„ç½‘ç»œåœ°å€ä¿¡æ¯ï¼šæœ¬åœ°æ¥å£ç›´æ¥åœ°å€ï¼ˆHost Candidateï¼‰ã€STUNæœåŠ¡å™¨åå°„åœ°å€ï¼ˆServer Reflexive Candidateï¼‰ä»¥åŠTURNä¸­ç»§åœ°å€ï¼ˆRelayed Candidateï¼‰ã€‚é€šå¸¸å†…ç½‘åœ°å€ä¼˜å…ˆçº§ä½äºå…¬ç½‘ç›´è¿åœ°å€ã€‚å¦‚æœå†…ç½‘ä¸èƒ½äº’é€šåˆ™èµ°ä¸­çº§TURNæœåŠ¡å™¨ï¼Œæµåª’ä½“æµé‡ä»TURNè½¬å‘ã€‚

å…¬å¼€çš„STUNæœåŠ¡å™¨éå¸¸å¤šï¼Œæ¯”å¦‚ï¼š(stun_host=â€˜stun.l.google.comâ€™, stun_port=19302)ã€‚

TURNæœåŠ¡å™¨å¯ä»¥è‡ªå·±æ­å»º[æ­å»ºç§æœ‰TURNæœåŠ¡å™¨](turn_server/README.md)ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨cloudflareå…è´¹æä¾›çš„æœåŠ¡å™¨ï¼ˆä½†æ˜¯å»¶è¿Ÿä¼šæ¯”è¾ƒå¤§ï¼Œä¸”ä¸ç¨³å®šï¼‰ã€‚å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡Blog[ã€WebRTCå…¨æµç¨‹ã€‘livekité…ç½®å…è´¹çš„cloudflare turnæœåŠ¡ - PiDan! | è™šæ‹Ÿä¸–ç•Œçš„æ‡’çŒ«çš„åšå®¢](https://pidan.dev/20250722/webrtc-livekit-deploy-config-turn-server/)

ç”³è¯·åï¼Œåªéœ€è¦é€šè¿‡ä»–æä¾›çš„ä¸€ä¸ªcmdå‘½ä»¤curlè·å–TURN server hostå’Œusernameï¼Œpasswordå°±è¡Œã€‚

#### 1.3 å¼€å‘æ¿ä¾èµ–å®‰è£…

```shel
sudo apt install g++ make cmake ffmpeg

# æ‰‹åŠ¨å®‰è£…libdatachannel
git clone https://github.com/paullouisageneau/libdatachannel.git
cd libdatachannel
git submodule update --init --recursive
mkdir build && cd build
cmake .. 
make -j2
sudo make install
```

> ffmpegå¯èƒ½å®‰è£…å¤±è´¥ï¼Œå»ºç«‹æ‰‹åŠ¨ç¼–è¯‘å®‰è£…
>
> å¼€å‘æ¿é€šå¸¸æ˜¯armæ¶æ„ï¼Œå¯ä»¥æ¢æˆæ¸…åçš„postæº

### 2.è®¾å¤‡æŸ¥æ‰¾

#### 2.1 æ‘„åƒå¤´å‚æ•°è·å–

```shel
root@orangepizero2:~# sudo v4l2-ctl --list-device
cedrus (platform:cedrus):
        /dev/video0
        /dev/media0

SIT USB2.0 Camera RGB: SIT USB2 (usb-5200000.usb-1.2):
        /dev/video1 # ç¬¬ä¸€ä¸ªæ‘„åƒå¤´
        /dev/video2
        /dev/media1
```
è·å–æ‘„åƒå¤´å‚æ•°ï¼šè§†é¢‘æ ¼å¼ï¼Œåˆ†è¾¨ç‡ï¼Œå¸§ç‡
```shell
root@orangepizero2:~# sudo v4l2-ctl -d /dev/video1 --list-formats-ext
ioctl: VIDIOC_ENUM_FMT
        Type: Video Capture

        [0]: 'MJPG' (Motion-JPEG, compressed) # è§†é¢‘æ ¼å¼
                Size: Discrete 640x480 # æ”¯æŒçš„åˆ†è¾¨ç‡
                        Interval: Discrete 0.033s (30.000 fps) # å„ç§å¸§ç‡æ”¯æŒ
                        Interval: Discrete 0.040s (25.000 fps)
                        Interval: Discrete 0.050s (20.000 fps)
                        Interval: Discrete 0.067s (15.000 fps)
                        Interval: Discrete 0.100s (10.000 fps)
                        Interval: Discrete 0.200s (5.000 fps)
                        Interval: Discrete 0.033s (30.000 fps)
                        Interval: Discrete 0.040s (25.000 fps)
                        Interval: Discrete 0.050s (20.000 fps)
                        Interval: Discrete 0.067s (15.000 fps)
                        Interval: Discrete 0.100s (10.000 fps)
                        Interval: Discrete 0.200s (5.000 fps)
                Size: Discrete 1920x1080
                ......

```

#### 2.2 éº¦å…‹é£å‚æ•°è·å–

```shel
root@orangepizero2:~# arecord -L
null
    Discard all samples (playback) or generate zero samples (capture)
hw:CARD=ahubhdmi,DEV=0
    ahubhdmi, ahub_plat-i2s-hifi i2s-hifi-0
    Direct hardware device without any conversions
plughw:CARD=ahubhdmi,DEV=0
    ahubhdmi, ahub_plat-i2s-hifi i2s-hifi-0
    Hardware device with all software conversions
default:CARD=ahubhdmi
    ahubhdmi, ahub_plat-i2s-hifi i2s-hifi-0
    Default Audio Device
sysdefault:CARD=ahubhdmi
    ahubhdmi, ahub_plat-i2s-hifi i2s-hifi-0
    Default Audio Device
dsnoop:CARD=ahubhdmi,DEV=0
    ahubhdmi, ahub_plat-i2s-hifi i2s-hifi-0
    Direct sample snooping device
hw:CARD=Audio,DEV=0 # ç¬¬ä¸€ä¸ªUSBéº¦å…‹é£
    AB13X USB Audio, USB Audio
    Direct hardware device without any conversions
plughw:CARD=Audio,DEV=0
    AB13X USB Audio, USB Audio
    Hardware device with all software conversions
default:CARD=Audio
    AB13X USB Audio, USB Audio
    Default Audio Device
sysdefault:CARD=Audio
    AB13X USB Audio, USB Audio
    Default Audio Device
front:CARD=Audio,DEV=0
    AB13X USB Audio, USB Audio
    Front output / input
dsnoop:CARD=Audio,DEV=0
    AB13X USB Audio, USB Audio
    Direct sample snooping device
```
è¯†åˆ«åˆ°åï¼Œå°±éœ€è¦è·å–é‡‡æ ·å‚æ•°ï¼šé‡‡æ ·ç‡ï¼ŒéŸ³é¢‘æ ¼å¼ï¼Œé€šé“æ•°ã€‚
```shell
root@orangepizero2:~# arecord --device=hw:CARD=Audio,DEV=0 --dump-hw-params
ACCESS:  MMAP_INTERLEAVED RW_INTERLEAVED
FORMAT:  S16_LE # éŸ³é¢‘æ ¼å¼
SUBFORMAT:  STD
SAMPLE_BITS: 16
FRAME_BITS: 16
CHANNELS: 1 # é€šé“æ•°
RATE: 48000 # é‡‡æ ·ç‡
PERIOD_TIME: [1000 1000000]
PERIOD_SIZE: [48 48000]
PERIOD_BYTES: [96 96000]
PERIODS: [2 1024]
BUFFER_TIME: [2000 2000000]
BUFFER_SIZE: [96 96000]
BUFFER_BYTES: [192 192000]
TICK_TIME: ALL
--------------------
arecord: set_params:1352: Sample format non available
Available formats:
- S16_LE
```

#### 2.3 ç”µæœºé©±åŠ¨å™¨æ¥å£è·å–

```shel
root@orangepizero2:~# ls /dev/ttyUSB*
/dev/ttyUSB0
```


#### 2.4 4Gç½‘ç»œæ¨¡å—æ¥å£è·å–
ä½¿ç”¨RNDISçš„4Gæ¨¡å—ï¼Œé€šå¸¸ç¬¬ä¸€ä¸ªä»¥enxå¼€å¤´çš„å°±æ˜¯4Gæ¨¡å—çš„ç½‘å¡ã€‚ç„¶åæŸ¥çœ‹è·¯ç”±ä¿¡æ¯ï¼Œpingæµ‹è¯•ä¸€ä¸‹ä¸Šç½‘æƒ…å†µã€‚

> å¦‚æœæ²¡æœ‰4Gæ¨¡å—ï¼Œç›´æ¥é…ç½®å¼€å‘æ¿ä¸ç”µè„‘è¿æ¥åŒä¸€ä¸ªWIFIä¹Ÿå¯ä»¥æ§åˆ¶ï¼

```shel
root@orangepizero2:~# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
5: enx2089846a96ab: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 1000
    link/ether 20:89:84:6a:96:ab brd ff:ff:ff:ff:ff:ff
    inet 192.168.10.2/24 brd 192.168.10.255 scope global dynamic noprefixroute 
       valid_lft 86396sec preferred_lft 86396sec
    inet6 xxxxxxxxxxxx/64 scope link noprefixroute
       valid_lft forever preferred_lft forever

root@orangepizero2:~# ip route
default via 192.168.10.1 dev enx2089846a96ab proto dhcp metric 100 # 4gç½‘å¡ä¼˜å…ˆä¸Šç½‘
```
è·å–å¯¹åº”çš„USBè°ƒè¯•ä¸²å£ï¼Œé€šå¸¸æ¥è¯´æ˜¯ä¸€ä¸ªä»¥ttyACMå¼€å¤´çš„ç¬¬ä¸€ä¸ªå°±æ˜¯ã€‚
```shell
root@orangepizero2:~# ls /dev/ttyACM*
/dev/ttyACM0  /dev/ttyACM1  /dev/ttyACM2
```

### 3.å®‰è£…å¯åŠ¨

#### 3.1 ç¼–è¯‘ç¨‹åº

```shell
git clone https://github.com/fy403/webrtc

# ç¼–è¯‘éŸ³è§†é¢‘é‡‡é›†ç¨‹åº
cd av_track
chmod +x ./build.sh 
chmod +x ./install.sh
./build.sh

# ç¼–è¯‘æ§åˆ¶ä¿¡å·ä¼ è¾“ç¨‹åº
cd data_track
chmod +x ./build.sh
chmod +x ./install.sh
./build.sh
```

#### 3.2 è¿è¡Œå®‰è£…è„šæœ¬

å¦‚æœä½¿ç”¨ä¸åŒçš„ç”µæœºé©±åŠ¨ç«¯å£ï¼Œéœ€è¦ä¿®æ”¹[constants.h](data_track/include/constants.h)ä¸­çš„å‰åå·¦å³æ§åˆ¶ç«¯å£ï¼Œä»¥åŠpwmè¡Œç¨‹ã€‚

```c++
// Motor control constants
const int MOTOR_FRONT_BACK = 2; // Control forward/backward
const int MOTOR_LEFT_RIGHT = 4; // Control left/right turn

const int16_t NEUTRAL_PWM = 0;
const int16_t MAX_FORWARD_PWM = 3500;
const int16_t MAX_REVERSE_PWM = -3500;

```
æ ¹æ®ä¹‹å‰çš„è·å–çš„é…ç½®ï¼Œä¿®æ”¹av_track/av_track_rtc.shæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š
```shell
#!/bin/bash
TARGET_HOST="fy403.cn" # ä¿¡ä»¤æœåŠ¡å™¨åœ°å€
TARGET_PORT=8000 # ä¿¡ä»¤æœåŠ¡å™¨ç«¯å£
IP_TYPE=4 # ipv4 or ipv6
VIDEO_DEVICE="/dev/video1" # é¦–é€‰æ‘„åƒå¤´è®¾å¤‡
VIDEO_DEVICE_BAK="/dev/video0" # å¤‡é€‰æ‘„åƒå¤´è®¾å¤‡
AUDIO_DEVICE="hw:CARD=Audio,DEV=0" # éŸ³é¢‘è®¾å¤‡
SAMPLE_RATE=48000 # éŸ³é¢‘é‡‡æ ·ç‡
CHANNELS=1 # éŸ³é¢‘é€šé“æ•°
AUDIO_FORMAT="S16LE" # éŸ³é¢‘æ ¼å¼
CHECK_INTERVAL=2  # Health check interval (seconds)
CLIENT_ID="usbcam" # å®¢æˆ·ç«¯IDï¼šä¸å¡«å†™ä½¿ç”¨éšæœºå€¼
STUN_SERVER="stun.l.google.com" # STUNæœåŠ¡å™¨åœ°å€
STUN_SERVER_PORT=19302 # STUNæœåŠ¡å™¨ç«¯å£
TURN_SERVER="turn.cloudflare.com" # TURNæœåŠ¡å™¨åœ°å€
TURN_SERVER_PORT=3478 # TURNæœåŠ¡å™¨ç«¯å£
USER="g0xxxxxxxxxxx" # TURNæœåŠ¡å™¨ç”¨æˆ·å
PASSWD="95yyyyyyyyy" # TURNæœåŠ¡å™¨å¯†ç 
RESOLUTION="1280x720" # ç”»é¢åˆ†è¾¨ç‡
FPS=20 # ç”»é¢å¸§ç‡
```
åŒç†ï¼Œä¿®æ”¹data_track/data_track_rtc.shæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š
```shell
#!/bin/bash
TARGET_HOST="fy403.cn" 
TARGET_PORT=8000
IP_TYPE=4
USER="g0xxxxxxxxxxx"
PASSWD="95yyyyyyyyy"
CHECK_INTERVAL=2  # Health check interval (seconds)
CLIENT_ID="dataTrack"
STUN_SERVER="stun.l.google.com"
STUN_SERVER_PORT=19302
TURN_SERVER="turn.cloudflare.com"
TURN_SERVER_PORT=3478
TTY_PORT=/dev/ttyUSB0 # ç”µæœºé©±åŠ¨æ¿usbç«¯å£
TTY_BAUDRATE=115200 # ç”µæœºé©±åŠ¨æ¿ä¸²å£æ³¢ç‰¹ç‡
GSM_PORT=/dev/ttyACM0 # 4gæ¨¡å—usbç«¯å£
GSM_BAUDRATE=115200 # 4gæ¨¡å—ä¸²å£æ³¢ç‰¹ç‡
```

ä¿®æ”¹å®Œæ¯•åç›´æ¥å…è®¸æ¯ä¸ªæ¨¡å—ä¸‹çš„`./install`å°±è¡Œå®‰è£…äº†å¹¶å¯åŠ¨äº†ã€‚

å¦‚æœéœ€è¦çŸ¥é“å‚æ•°ç»†èŠ‚ï¼Œæˆ–é…ç½®æ›´å¤šå‚æ•°ã€‚å¯åœ¨buildç›®å½•ä¸‹ä½¿ç”¨`./web_publisher -h`æŸ¥çœ‹infoã€‚
```shell
root@orangepizero2:~/webrtc/av_track/cmake-build-debug-zero2# ./webrtc_publisher -h
usage: ./webrtc_publisher [ -enstwxhv ]
libdatachannel client implementing WebRTC Data Channels with WebSocket signaling
   [ -n ] [ --noStun ] (type=FLAG)
          Do NOT use a stun server (overrides -s and -t).
   [ -s ] [ --stunServer ] (type=STRING, default=stun.l.google.com)
          STUN server URL or IP address.
   [ -t ] [ --stunPort ] (type=INTEGER, range=0...65535, default=19302)
          STUN server port.
   [ -w ] [ --webSocketServer ] (type=STRING, default=localhost)
          Web socket server URL or IP address.
   [ -x ] [ --webSocketPort ] (type=INTEGER, range=0...65535, default=8000)
          Web socket server port.
   [ -m ] [ --udpMux ] (type=FLAG)
          Use UDP multiplex.
   [ -u ] [ --turnServer ] (type=STRING)
          TURN server URL or IP address.
   [ -p ] [ --turnPort ] (type=INTEGER, range=0...65535, default=3478)
          TURN server port.
   [ -U ] [ --turnUser ] (type=STRING)
          TURN server username.
   [ -P ] [ --turnPass ] (type=STRING)
          TURN server password.
   [ -i ] [ --inputDevice ] (type=STRING, default)=
          Input video device.
   [ -a ] [ --audioDevice ] (type=STRING, default=none)
          Input audio device.
   [ -r ] [ --sampleRate ] (type=INTEGER, default=48000)
          Audio sample rate.
   [ -C ] [ --channels ] (type=INTEGER, default=1)
          Audio channels.
   [ -f ] [ --audioFormat ] (type=STRING, default=S16LE)
          Audio input_format.
   [ -V ] [ --videoFormat ] (type=STRING, default=mjpeg)
          Video input format.
   [ -c ] [ --client_id ] (type=STRING)
          Client identifier.
   [ -d ] [ --debug ] (type=FLAG)
          Enable debug output.
   [ -R ] [ --resolution ] (type=STRING, default=640x480)
          Video resolution in WIDTHxHEIGHT input_format.
   [ -F ] [ --framerate ] (type=INTEGER, range=1...120, default=30)
          Video encoding framerate.
   [ -h ] [ --help ] (type=FLAG)
          Display this help and exit.
```

#### 3.3 å‰ç«¯æ“ä½œ
ç¼–è¾‘htmlæ›¿æ¢ä¿¡ä»¤æœåŠ¡å™¨åœ°å€å’ŒSTUN/TURNæœåŠ¡å™¨åœ°å€

å‰å¾€ï¼š[data_rtc.js](data_track/web/data_rtc.js)

```js
 const dataConfig = {
    iceServers: [{
      urls: 'stun:stun.l.google.com:19302', // change to your STUN server
    }],
  };


  const dataUrl = `ws://fy403.cn:8000/${dataLocalId}`;
```
å‰å¾€ï¼š[video_rtc.js](data_track/web/video_rtc.js)
```js
    const url = `ws://fy403.cn:8000/${localId}`;
    const config = {
        iceServers: [{
                "urls": ["stun:stun.cloudflare.com:3478",
                    // "stun:stun.cloudflare.com:53"
                ]
            },
            {
                "urls": [
                    "turn:turn.cloudflare.com:3478?transport=udp",
                ],
                "username": "g0xxxxxxxxxxx",
                "credential": "95yyyyyyyyy"
            },
        ],
    };
```

æµè§ˆå™¨æ‰“å¼€[index.html](data_track/web/index.html)ç­‰å¾…ç”»é¢å’Œä¿¡å·è¿æ¥æ­£å¸¸åï¼Œå…ˆæŒ‰`f`æ¢æŒ¡(æŒ‰ä¸€æ¬¡Fæ¢æŒ¡ä¸€æ¬¡)ï¼Œä¸€å…±äº”æ¡£å¯è°ƒï¼š
```c++
// Throttle levels
const ThrottleLevel THROTTLE_LEVELS[] = {
    {0, 0, "Stop"},
    {1, 25, "Low speed"},
    {2, 50, "Medium speed"},
    {3, 75, "Fast"},
    {4, 100, "Full speed"}
};
```
é€šè¿‡`wsad`æ“ä½œï¼Œ`ç©ºæ ¼`æ€¥åœã€‚æŒ‰`q`é‡å¯å¼€å‘æ¿çš„ä¿¡å·æœåŠ¡ã€‚

å¦‚æœè‡ªå®šä¹‰äº†client_idï¼Œåˆ™éœ€è¦ä¿®æ”¹æ­¤å¤„ã€‚ä¿®æ”¹åç‚¹å‡»Sendå¯ä»¥é‡æ–°å»ºç«‹P2Pè¿æ¥

<img src="README.assets\image-20251030141913114.png" alt="image-20251030141913114" style="zoom:80%;" />

## æŠ€æœ¯ç»†èŠ‚

### 1.ç³»ç»Ÿæ¶æ„å›¾
<img src="README.assets\image-20251030170418827.png" alt="image-20251030170418827" style="zoom:80%;" />
WebRTCï¼ˆWeb Real-Time Communicationï¼‰æ˜¯ä¸€ç§å¼€æºæŠ€æœ¯ï¼Œæ”¯æŒæµè§ˆå™¨ã€ç§»åŠ¨ç«¯å’ŒåµŒå…¥å¼è®¾å¤‡ä¹‹é—´çš„å®æ—¶éŸ³è§†é¢‘å’Œæ•°æ®ä¼ è¾“ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯é€šè¿‡ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰è¿æ¥å®ç°ä½å»¶è¿Ÿé€šä¿¡ï¼Œæ— éœ€å®‰è£…æ’ä»¶æˆ–ä¸­é—´åª’ä»‹ã€‚å¯ä»¥å‚è€ƒ[WebRTCè¿æ¥åŸç†](https://blog.csdn.net/yanceyxin/article/details/149752514)

åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œå°†éŸ³è§†é¢‘æ•°æ®é€šé“å’Œæ§åˆ¶ä¿¡å·é€šé“åˆ†ç¦»ï¼Œåˆ†åˆ«åœ¨ä¸åŒçš„RTPè¿æ¥ä¸­ä¼ é€’æ•°æ®ã€‚é¿å…å½¼æ­¤ç›¸äº’å¹²æ‰°ã€‚ä½¿ç”¨WebRTCçš„ä¸»è¦ç›®çš„åœ¨äºï¼š

- å®ƒæ˜¯ä¸€é¡¹æä¾›ä½å»¶è¿Ÿã€é«˜è´¨é‡å®æ—¶éŸ³é¢‘å’Œè§†é¢‘é€šä¿¡çš„æŠ€æœ¯ã€‚
- å®ƒæ˜¯ä¸€ä¸ªå…¨é¢çš„å®¢æˆ·ç«¯å¤šåª’ä½“æ¡†æ¶ï¼Œå…·æœ‰éŸ³é¢‘å’Œè§†é¢‘å¤„ç†èƒ½åŠ›ï¼Œæ—¨åœ¨è·¨å¹³å°å…¼å®¹ã€‚
- å®ƒæ˜¯ä¸€ç»„æ ‡å‡†åŒ–çš„APIï¼ˆæ˜¯W3Cæ¨èçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå…è®¸ç½‘é¡µå¼€å‘è€…åˆ›å»ºå¤šæ ·åŒ–çš„å®æ—¶éŸ³é¢‘å’Œè§†é¢‘åº”ç”¨ç¨‹åºã€‚

> [è…¾è®¯TRTC: WebRTCæ˜¯å¦‚ä½•å·¥ä½œçš„ä»¥åŠå®ƒçš„ä¼˜ç¼ºç‚¹](https://trtc.io/zh/blog/details/what-is-webrtc))

### 2. è¿æ¥å»ºç«‹æµç¨‹
WebRTCçš„è¿æ¥å»ºç«‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š

1. **å€™é€‰åœ°å€**ï¼šé€šè¿‡ICEæœåŠ¡å™¨è·å–ç½‘ç»œåœ°å€IPï¼Œå³ICEå€™é€‰è€…ä¿¡æ¯ã€‚
2. **ä¿¡ä»¤äº¤æ¢**ï¼šé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨ï¼ˆå€ŸåŠ©WebSocketï¼‰ä¼ é€’SDPï¼ˆSession Description Protocolï¼‰å’ŒICEå€™é€‰è€…ä¿¡æ¯ã€‚
3. **åª’ä½“åå•†**ï¼šåŒæ–¹äº¤æ¢SDPï¼Œç¡®å®šç¼–è§£ç å™¨ã€åˆ†è¾¨ç‡ç­‰å‚æ•°ã€‚
4. **ç½‘ç»œç©¿é€**ï¼šé€šè¿‡ICEä¿¡æ¯å°è¯•P2Pï¼ˆå€ŸåŠ©UDPï¼‰è¿æ¥ï¼Œè‹¥å¤±è´¥åˆ™å›é€€åˆ°TURNä¸­ç»§æµé‡ã€‚æ‰€æœ‰æµé‡éƒ½ç»è¿‡TURNæœåŠ¡å™¨ä¸­è½¬ã€‚

### 3. æ•°æ®ä¼ è¾“è¿‡ç¨‹

å½“éŸ³è§†é¢‘RTPä¸æ•°æ®RTPé€šé“å»ºç«‹åï¼Œå¼€å‘æ¿å°†æ•è·çš„éŸ³è§†é¢‘æ•°æ®è¿›è¡Œç¼–ç ã€‚ä¹‹åï¼Œå€ŸåŠ©4Gç½‘ç»œå°†ç¼–ç æ•°æ®æ¨é€åˆ°æ¡Œé¢ç«¯ã€‚æ¡Œé¢ç«¯å°†é”®é¼ æ“ä½œå°è£…ä¸ºæ§åˆ¶å¸§ï¼ŒåŒæ ·å€ŸåŠ©4Gç½‘ç»œä¼ è¾“åˆ°å¼€å‘æ¿ã€‚æœ€åï¼Œå¼€å‘æ¿é€šè¿‡é©±åŠ¨ç¨‹åºå°†æ§åˆ¶ä¿¡å·è½¬æ¢ä¸ºæ§åˆ¶å‘½ä»¤ï¼Œé€šè¿‡ä¸²å£å‘é€åˆ°ç”µæœºé©±åŠ¨å™¨ã€‚ç”µæœºé©±åŠ¨å™¨æ§åˆ¶é©¬è¾¾å·¥ä½œã€‚

### 4.éŸ³è§†é¢‘å·¥ä½œè¿‡ç¨‹

<img src="README.assets\image-20251030185412346.png" alt="image-20251030185412346" style="zoom:80%;" />

### 3.ææ–™æ¸…å•

|      åç§°       | ä»·æ ¼ |                    å¤‡æ³¨                     |
|:-------------:| :--: | :-----------------------------------------: |
| OrangepiZero2 | 125  | å»ºè®®ä¹°å¸¦GPUåŠ é€Ÿçš„å¼€å‘æ¿å¹¶é™„å¸¦ã€æ–‡æ¡£ã€‘ï¼ï¼ï¼ |
|     å››è·¯é©±åŠ¨å™¨     |  40  |   è¦ç•™æ„æ˜¯å¦å¯ä»¥ç¨³å®šæ¿è½½5Vç»™å¼€å‘æ¿å­ä¾›ç”µ    |
|      æ‘„åƒå¤´      |  40  |          æœ€å¥½ä¹°USBå…é©±çš„ï¼Œç›´æ’ç›´ç”¨          |
|    4Gç½‘ç»œæ¨¡å—     |  20  |           æœ€å¥½æ˜¯ä¹°æ”¯æŒRNDISçš„æ¨¡å—           |
|     RCé¥æ§è½¦     | 160  |      é€‰æ‹©è‡ªå·±å–œæ¬¢çš„å‹å·ã€è¦æ–¹ä¾¿æ”¹é€ ã€‘       |
|    7.4Vç”µæ±      |  10  |          è®°å½•é€‰å¤§å®¹é‡ã€ç•™æ„å°ºå¯¸ã€‘           |
|    USBæ‰©å±•çº¿     |  12  |               å°½é‡é€‰æ¨¡å—åŒ–çš„                |
|     è‹¥å¹²çº¿æ      |  20  |               å‡†å¤‡ä¸€äº›æœé‚¦çº¿                |

<img src="README.assets\image-20251029212435996.png" alt="image-20251029212435996" style="zoom:83%;" />

> å°½é‡é€‰æ‹©å¸¦GPUçš„å¼€å‘æ¿å­ï¼Œå¹¶ä¸”è¿˜éœ€è¦è·å–æ¿å­å®‰è£…é©±åŠ¨çš„æ–‡æ¡£ã€‚è¿™æ ·éŸ³è§†é¢‘ç¼–è§£ç é€Ÿåº¦å¿«ï¼Œä¹Ÿèƒ½ç¼“è§£CPUçš„å‹åŠ›ã€‚
>
> ä»£ç é‡Œé¢æ˜¯ä¸å¸¦GPUåŠ é€Ÿï¼Œä»ç„¶æ˜¯è½¯ç¼–ç (æ•ˆæœè¿˜å¯ä»¥)ã€‚æ¿å­æ˜¯4H1Gï¼Œæ­£å¸¸å·¥ä½œCPUåˆ©ç”¨ç‡å¹³å‡30%ï¼Œå†…å­˜å ç”¨300MBï¼ŒéŸ³è§†é¢‘ç ç‡1.8Mbpsï¼Œè§†é¢‘å»¶è¿Ÿ300mså·¦å³ã€‚
><img src="README.assets\image-20251030135634832.png" alt="image-20251030135634832" style="zoom:80%;" />

<img src="README.assets\image-20251029180420095.png" alt="image-20251029180420095" style="zoom: 50%;" />

> é©±åŠ¨æ¿å°½é‡é€‰æ‹©å¸¦ç¨³å‹BECç»™å‡ºå¼€å‘æ¿ä¾›ç”µï¼Œä½†æ˜¯æœ‰äº›å¼€å‘æ¿åŠŸè€—æ¯”è¾ƒå¤§ã€‚ç”¨è¿™å—é©±åŠ¨æ¿å¯èƒ½å¸¦ä¸èµ·æ¥ã€‚è¿™æ—¶å€™å¯ä»¥ä¹°ä¸€ä¸ª5Vçš„ç”µæ± å•ç‹¬ç»™å¼€å‘æ¿ä¾›ç”µã€‚
>
> è¿™æ¬¾å¼€å‘æ¿è¿˜æ”¯æŒç¼–ç ç”µæœºï¼Œåç»­å¦‚æœè¦å‡çº§ä¹Ÿæ¯”è¾ƒå¥½ã€‚

<img src="README.assets\image-20251103205553057.png" alt="image-20251103205553057" style="zoom: 50%;" />

> é€‰æ‹©4Gæ¨¡å—å°½é‡é€‰æ‹©æ”¯æŒRNDISçš„ï¼Œè¿™æ ·æ’ä¸ŠUSBå’Œä¾›ç”µå°±èƒ½ç›´æ¥è¯†åˆ«ä¸ºä¸€ä¸ªç½‘ç»œæ¥å£ã€å…å»é…ç½®ã€‘ã€‚ä¾›ç”µ7.4Vï¼Œç”¨5Vä¾›ç”µä¼šå¯¼è‡´ä¿¡å·é€Ÿç‡ä½ã€‚
>
> æ‘„åƒå¤´å¯ä»¥ç”¨ç¬¬ä¸€ç§å•ç›®çš„ã€ä¼˜ç‚¹ï¼šæŸ”è½¯ï¼Œå°å‹åŒ–ï¼Œå·²å®‰è£…ï¼Œç¼ºç‚¹ï¼šè¿‡çƒ­ï¼Œå®¹æ˜“çƒ§æ¯ï¼Œæ’çº¿æ˜“æ–­ï¼ˆç›®å‰åŸºæœ¬æ²¡çœ‹è§å¸¦ä¿ä¿®çš„ï¼Œæ…é‡é€‰æ‹©ï¼ï¼ï¼ï¼‰ã€‘ï¼Œç¬¬äºŒç§æ˜¯å¸¦ä¿ä¿®ä¸€å¹´ï¼Œä¸€æ ·çš„ä»·æ ¼ï¼Œè™½ç„¶å¤§ä¸€äº›ï¼›ä½†ç”¨æ–™å¥½ï¼Œå€¼å¾—å…¥æ‰‹ã€‚
>
> éº¦å…‹é£æ ¹æ®å¼€å‘æ¿æ¥é€‰æ‹©æ¥å£ï¼Œä¼˜å…ˆé€‰æ‹©å¸¦é™å™ªçš„ã€‚

## åç»­è®¡åˆ’

- [ ] æ§åˆ¶ç«¯è¯­éŸ³æ¨é€
- [ ] è¢«æ§ç«¯æ‰¬å£°å™¨æ’­æ”¾
- [ ] ç¼–ç å™¨ç”µæœºæ”¯æŒ
- [ ] GPUåŠ é€ŸéŸ³è§†é¢‘æ¨æµ
- [ ] æ”¯æŒROSç³»ç»Ÿ
- [ ] ä¸‰ç»´é‡å»º
- [ ] AIæ¨¡å‹æ¥å…¥
- [ ] è‡ªä¸»å¯¼èˆª

## QQç¾¤äº¤æµ
<img src="README.assets\qrcode_1764133405428.jpg" alt="qrcode_1764133405428" style="zoom: 50%;" />
